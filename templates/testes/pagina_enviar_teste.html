{% extends "base.html" %}
{% block title %}Página Principal{% endblock %}

{% block main %}
  <div style="width:100%;">
    <div class="content">
      <h1 style="text-align:center;color:var(--primary);text-transform:uppercase;margin-top:0;">
        Hackathon Controle Social - Desafio Participa DF
      </h1>

      <div class="card" style="padding:20px;">
        <form method="POST" class="pure-form pure-form-stacked">
          <div class="form-row">
            <textarea name="mensagem" class="input" rows="4" placeholder="Digite uma solicitação"></textarea>
          </div>
          <button type="submit" class="btn-primary">Enviar</button>
        </form>

        {% if resposta %}
          {% if resposta.STATUS == "True" %}
            <div style="margin-top:16px;" class="card">
              <div style="padding:12px;background:var(--danger);color:#fff;border-radius:6px;font-weight:700;">
                STATUS: Essa solicitação não pode ser processada, porque contém pedido de informações pessoais.
              </div>

              <p style="margin-top:12px;"><strong>Análise por linha:</strong></p>
              <table class="table">
                <thead>
                  <tr>
                    <th>Linha</th>
                    <th>Status</th>
                    <th>Dados sensíveis detectados</th>
                    <th>Verbos de solicitação</th>
                    <th>Interrogativas</th>
                  </tr>
                </thead>
                <tbody>
                  {% for linha in resposta.linhas %}
                    <tr>
                      <td>{{ linha.texto }}</td>
                      <td>
                        {% if linha.status == "True" %}
                          <span class="badge badge-danger">Sensível</span>
                        {% else %}
                          <span class="badge badge-success">Seguro</span>
                        {% endif %}
                      </td>
                      <td>{{ linha.encontrados | join(', ') if linha.encontrados else 'Nenhum' }}</td>
                      <td>{{ linha.verbos | join(', ') if linha.verbos else 'Nenhum' }}</td>
                      <td>{{ linha.interrogativas | join(', ') if linha.interrogativas else 'Nenhuma' }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div style="margin-top:16px;" class="card">
              <div style="padding:12px;background:var(--success);color:#fff;border-radius:6px;font-weight:700;">
                STATUS: Essa solicitação pode ser atendida.
              </div>

              <p style="margin-top:12px;"><strong>Análise por linha:</strong></p>
              <table class="table">
                <thead>
                  <tr>
                    <th>Linha</th>
                    <th>Status</th>
                    <th>Dados sensíveis detectados</th>
                    <th>Verbos de solicitação</th>
                    <th>Interrogativas</th>
                  </tr>
                </thead>
                <tbody>
                  {% for linha in resposta.linhas %}
                    <tr>
                      <td>{{ linha.texto }}</td>
                      <td>
                        {% if linha.status == "True" %}
                          <span class="badge badge-danger">Sensível</span>
                        {% else %}
                          <span class="badge badge-success">Seguro</span>
                        {% endif %}
                      </td>
                      <td>{{ linha.encontrados | join(', ') if linha.encontrados else 'Nenhum' }}</td>
                      <td>{{ linha.verbos | join(', ') if linha.verbos else 'Nenhum' }}</td>
                      <td>{{ linha.interrogativas | join(', ') if linha.interrogativas else 'Nenhuma' }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}