{% extends "base.html" %}

{% block main %}
    <div class="profile-container" style="display: flex; gap: 40px; align-items: flex-start; padding: 20px;">

        <aside class="profile-sidebar">
            <div class="card-glow"
                 style="--card-color: var(--primary); width: 260px; padding: 20px; text-align: center; border-radius: 15px;">
                <div class="photo-frame">
                    {% if usuario.foto %}
                        <img src="{{ url_for('static', filename='uploads/' + usuario.foto) }}" class="user-photo">
                    {% else %}
                        <div class="user-photo-placeholder">{{ usuario.nome[0] | upper }}</div>
                    {% endif %}
                </div>

                <h3 style="margin-top: 15px; color: var(--text-main);">{{ usuario.nome }}</h3>
                <p class="muted"
                   style="font-size: 0.85rem; min-height: 50px;">{{ usuario.bio or 'Sem biografia definida.' }}</p>

                <button onclick="toggleEdicao()" class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                    <i class="fas fa-user-edit"></i> Editar Perfil
                </button>
            </div>
        </aside>

        <section class="profile-details" style="flex: 1;">

            <div id="view-info" class="glass-card" style="padding: 30px;">
                <h3 style="margin-bottom: 20px;"><i class="fas fa-info-circle"></i> Meus Dados</h3>
                <table class="doc-table">
                    <tr>
                        <td><strong>E-mail:</strong></td>
                        <td>{{ usuario.email }}</td>
                    </tr>
                    <tr>
                        <td><strong>Telefone:</strong></td>
                        <td>{{ usuario.telefone or 'Não informado' }}</td>
                    </tr>
                    <tr>
                        <td><strong>GitHub:</strong></td>
                        <td>{{ usuario.github or 'Não informado' }}</td>
                    </tr>
                </table>
            </div>

            <div id="edit-form" class="glass-card" style="display: none; padding: 30px; animation: fadeIn 0.3s;">
                <h3 style="margin-bottom: 20px;"><i class="fas fa-user-cog"></i> Atualizar Perfil</h3>
                <form action="{{ url_for('perfil.atualizar_perfil') }}" method="POST" enctype="multipart/form-data">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>Nome Completo</label>
                            <input type="text" name="nome" value="{{ usuario.nome }}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Foto de Perfil</label>
                            <input type="file" name="foto" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Telefone</label>
                            <input type="text" name="telefone" value="{{ usuario.telefone or '' }}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>GitHub (Link)</label>
                            <input type="text" name="github" value="{{ usuario.github or '' }}" class="form-input">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label>Biografia</label>
                            <textarea name="bio" class="form-input" rows="3">{{ usuario.bio or '' }}</textarea>
                        </div>
                    </div>
                    <div style="margin-top: 25px; display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-success">Salvar</button>
                        <button type="button" onclick="toggleEdicao()" class="btn btn-outline">Cancelar</button>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <script>
        function toggleEdicao() {
            const form = document.getElementById('edit-form');
            const info = document.getElementById('view-info');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                info.style.display = 'none';
            } else {
                form.style.display = 'none';
                info.style.display = 'block';
            }
        }
    </script>

    <style>
        .photo-frame {
            width: 100%;
            aspect-ratio: 3 / 4; /* Proporção 3x4 */
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            border: 2px dashed #ddd;
        }

        .user-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-photo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            background: var(--primary);
            color: white;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 5px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
{% endblock %}