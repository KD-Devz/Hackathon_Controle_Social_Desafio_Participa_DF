{% extends "base.html" %}
{% block title %}Enviar Solicitação Anônima{% endblock %}

{% block main %}
    <div class="section-header" style="margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
        <h2 style="margin: 0; color: var(--primary);">
            <i class="fas fa-user-secret"></i> Solicitação Anônima
        </h2>
    </div>

    <form method="POST" action="{{ url_for('anonimo.enviar_solicitacao_anonima') }}" class="doc-form">
        <div class="form-group">
            <label style="font-weight: 600; display: block; margin-bottom: 10px;">Conteúdo da Solicitação:</label>
            <textarea name="solicitacao" class="doc-textarea"
                      placeholder="Digite aqui sua solicitação sem identificação pessoal..."
                      style="min-height: 150px; width: 100%;" required></textarea>
            <p class="muted">Sua solicitação será analisada automaticamente para verificar a presença de dados sensíveis
                antes do envio.</p>
        </div>
        <div style="margin-top: 15px;">
            <button type="submit" class="btn-primary" style="padding: 12px 30px;">
                <i class="fas fa-paper-plane"></i> Enviar
            </button>
        </div>
    </form>

    {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
            {% for category, resposta in messages %}
                <div style="background: transparent; height: 20px;">
                </div>

                <div style="padding: 25px; border-radius: 12px; text-align: center; margin-bottom: 35px;
                        background-color: {% if resposta.STATUS == 'True' %}#fff5f5{% else %}#f0fff4{% endif %};
                        border: 2px solid {% if resposta.STATUS == 'True' %}#feb2b2{% else %}#9ae6b4{% endif %};">

                    <h3 style="margin: 0; color: {% if resposta.STATUS == 'True' %}#c53030{% else %}#22543d{% endif %}; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        {% if resposta.STATUS == 'True' %}
                            <i class="fas fa-exclamation-triangle"></i> RISCO DETECTADO
                        {% else %}
                            <i class="fas fa-shield-check"></i> CONTEÚDO SEGURO
                        {% endif %}
                    </h3>
                    <p style="margin-top: 10px; color: #4a5568; font-weight: 500; font-size: 1rem;">
                        {% if resposta.STATUS == 'True' %}
                            A análise identificou padrões que violam a política de privacidade (LGPD).
                        {% else %}
                            Esta solicitação está em conformidade com as normas de transparência ativa.
                        {% endif %}
                    </p>
                </div>
                <div class="analysis-result" style="margin-top: 40px; animation: fadeIn 0.5s ease;">
                    {% if resposta.STATUS == "True" %}
                        <div class="alert alert-danger" style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 1.5rem;"></i>
                            <strong>BLOQUEADO:</strong> Esta solicitação contém dados sensíveis e não pode ser enviada.
                        </div>
                    {% else %}
                        <div class="alert alert-success" style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-check-circle" style="font-size: 1.5rem;"></i>
                            <strong>APROVADO:</strong> Solicitação válida e segura para processamento.
                        </div>
                    {% endif %}

                    <h3 style="margin: 25px 0 15px; font-size: 1.1rem;">
                        <i class="fas fa-list-ul"></i> Detalhamento da Análise:
                    </h3>

                    <table class="doc-table">
                        <thead>
                        <tr>
                            <th>Fragmento de Texto</th>
                            <th style="text-align: center;">Status</th>
                            <th>Entidades Encontradas</th>
                            <th>Verbos</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for linha in resposta.linhas %}
                            <tr>
                                <td style="font-size: 0.9rem;">"{{ linha.texto }}"</td>
                                <td style="text-align: center;">
                                    {% if linha.status == "True" %}
                                        <span class="badge"
                                              style="background: var(--danger); color: white; padding: 4px 8px; border-radius: 4px;">Sensível</span>
                                    {% else %}
                                        <span class="badge"
                                              style="background: var(--success); color: white; padding: 4px 8px; border-radius: 4px;">Seguro</span>
                                    {% endif %}
                                </td>
                                <td style="color: var(--secondary); font-weight: 600;">
                                    {{ linha.encontrados|join(', ') if linha.encontrados else '--' }}
                                </td>
                                <td class="muted" style="font-size: 0.85rem;">
                                    {{ linha.verbos|join(', ') if linha.verbos else '--' }}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
{% endblock %}
