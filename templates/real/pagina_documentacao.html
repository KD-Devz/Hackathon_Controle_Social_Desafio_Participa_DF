{% extends "base.html" %}

{% block title %}Documentação Técnica{% endblock %}

{% block main %}
<div class="doc-container">
    <!-- Sidebar -->
    <aside class="doc-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-layer-group"></i>
            <span>Painel Técnico</span>
        </div>
        <nav class="doc-nav">
            <button class="doc-btn active" data-target="arquitetura">Arquitetura</button>
            <button class="doc-btn" data-target="instalacao">Instalação</button>
            <button class="doc-btn" data-target="execucao">Execução</button>
            <button class="doc-btn" data-target="formatos">Formatos</button>
            <button class="doc-btn" data-target="metodologia">Metodologia</button>
            <button class="doc-btn" data-target="seguranca">Segurança</button>
            <button class="doc-btn" data-target="api">API Reference</button>
            <hr class="nav-divider">
            <button class="doc-btn btn-community" data-target="comunidade">
                <i class="fas fa-comments"></i> Comunidade
            </button>
        </nav>
    </aside>

    <!-- Conteúdo -->
    <section class="doc-content-area" id="content-viewport">

        <article id="arquitetura" class="section active">
            <h2 class="section-title"><i class="fas fa-sitemap"></i> Arquitetura do Sistema</h2>
            <p>O <strong>Valida FacilPrivacy Shield</strong> foi projetado sob o paradigma de microsserviços lógicos...</p>
            <ul class="doc-list">
                <li><strong>Core Engine:</strong> Módulo Python especializado em processamento de strings e validação de PII.</li>
                <li><strong>ORM Layer:</strong> SQLAlchemy para abstração do banco de dados.</li>
                <li><strong>Pipeline de Validação:</strong> Sanitização → Regex → Checksum → NLP.</li>
            </ul>
        </article>

        <article id="instalacao" class="section">
            <h2 class="section-title"><i class="fas fa-download"></i> Guia de Instalação</h2>
            <pre class="code-block"><code>git clone https://github.com/CalebeAF02/Gerenciador-De-Hoteis---UNB.git
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt</code></pre>
        </article>

        <article id="execucao" class="section">
            <h2 class="section-title"><i class="fas fa-play"></i> Execução do Projeto</h2>
            <pre class="code-block"><code>python app.py</code></pre>
            <p>Acesse em: <a href="http://127.0.0.1:5000">http://127.0.0.1:5000</a></p>
        </article>

        <article id="formatos" class="section">
            <h2 class="section-title"><i class="fas fa-file-code"></i> Formatos e Protocolos</h2>
            <table class="doc-table">
                <thead>
                    <tr><th>Interface</th><th>Formato de Entrada</th></tr>
                </thead>
                <tbody>
                    <tr><td>Web App</td><td>Formulário Multipart/Form-data</td></tr>
                    <tr><td>API REST</td><td>JSON (Application/json)</td></tr>
                </tbody>
            </table>
        </article>

        <article id="metodologia" class="section">
            <h2 class="section-title"><i class="fas fa-microscope"></i> Metodologia Híbrida</h2>
            <div class="method-box">
                <h4>1. Regex de Alta Performance</h4>
                <p>Identificação de padrões estruturais.</p>
                <h4>2. Validação Matemática</h4>
                <p>Algoritmo Módulo 11 para CPF/CNPJ.</p>
                <h4>3. NLP</h4>
                <p>Detecção de nomes e cargos via PLN.</p>
            </div>
        </article>

        <article id="seguranca" class="section">
            <h2 class="section-title"><i class="fas fa-shield-alt"></i> Segurança e LGPD</h2>
            <ul class="doc-list">
                <li><strong>Minimização:</strong> Dados brutos não são persistidos.</li>
                <li><strong>Sanitização:</strong> Proteção contra XSS e SQL Injection.</li>
                <li><strong>Hashing:</strong> Logs com SHA-256.</li>
            </ul>
        </article>

        <article id="api" class="section">
            <h2 class="section-title"><i class="fas fa-terminal"></i> API Reference</h2>
            <pre class="code-block"><code>{ "texto": "Solicitação do CPF 123.456..." }</code></pre>
        </article>

        <article id="comunidade" class="section">
            <h2 class="section-title"><i class="fas fa-comments"></i> Comunidade</h2>
            <form method="POST" action="{{ url_for('documentacao.comentar_documentacao') }}" class="doc-form">
                <input type="text" name="nome" placeholder="Seu Nome/Instituição" class="doc-input">
                <textarea name="comentario" placeholder="Sugestão técnica..." class="doc-textarea"></textarea>
                <button type="submit" class="btn-primary full-width">Enviar Comentário</button>
            </form>
            <div class="comment-list">
                {% if comentarios %}
                    {% for c in comentarios %}
                    <div class="comment-card">
                        <strong>{{ c.nome }}</strong> <small>— {{ c.criado_em }}</small>
                        <p>{{ c.comentario }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="muted">Nenhum feedback registrado.</p>
                {% endif %}
            </div>
        </article>

    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.doc-btn');
        const sections = document.querySelectorAll('.section');

        function showSection(id) {
            sections.forEach(s => {
                s.classList.remove('active');
            });
            buttons.forEach(b => b.classList.remove('active'));

            const targetSection = document.getElementById(id);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            const targetButton = document.querySelector(`[data-target="${id}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                showSection(btn.getAttribute('data-target'));
            });
        });
    });
</script>
{% endblock %}
