{% extends "base.html" %}

{% block title %}Meu Histórico | Valida Fácil{% endblock %}

{% block main %}
    <section class="content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
            <h2 style="margin: 0; color: var(--primary);"><i class="fas fa-history"></i> Histórico de Solicitações</h2>
            <span class="badge"
                  style="background: var(--primary); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 600;">
            {{ solicitacoes|length }} Registros
        </span>
        </div>

        <div class="card-glow"
             style="--card-color: var(--secondary); padding: 20px; margin-bottom: 30px; display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-shield-alt" style="font-size: 1.5rem; color: var(--secondary);"></i>
            <div style="font-size: 0.95rem; color: var(--text-main);">
                Processado via motor <strong>Privacy Shield</strong>. O detalhamento da análise de dados sensíveis está
                disponível no botão <strong>Auditoria</strong>.
            </div>
        </div>

        <div style="background: white; border-radius: 12px; box-shadow: var(--shadow); overflow: hidden;">
            <table class="doc-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                <tr style="background: #f8f9fa;">
                    <th style="width: 200px; padding: 12px; color: black; text-align: left;">
                        <i class="far fa-calendar-alt"></i> Data de Envio
                    </th>
                    <th style="padding: 12px; color: black; text-align: left;">
                        <i class="fas fa-comment-alt"></i> Conteúdo da Mensagem
                    </th>
                    <th style="width: 150px; text-align: center; padding: 12px; color: black;">
                        <i class="fas fa-tools"></i> Ações
                    </th>
                </tr>
                </thead>
                <tbody>
                {% if solicitacoes %}
                    {% for texto, data, id_real in solicitacoes %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td class="muted"
                                style="font-family: 'Courier New', monospace; font-weight: 600; padding: 12px; color: #666;">
                                {{ data }}
                            </td>
                            <td style="padding: 12px;">
                                <div style="max-width: 500px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: black;"
                                     title="{{ texto }}">
                                    {{ texto }}
                                </div>
                            </td>
                            <td style="text-align: center; padding: 12px;">
                                <a href="{{ url_for('solicitacao.detalhes_solicitacao', solicitacao_id=id_real) }}"
                                   class="btn-primary"
                                   style="background-color: #5a9e94; color: white; text-decoration: none; padding: 8px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; border: none; transition: background 0.3s ease;">
                                    <i class="fas fa-file-contract"></i> Auditoria
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 30px; color: #666; font-style: italic;">
                            <i class="fas fa-info-circle"></i> Nenhuma solicitação encontrada no histórico.
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>

        <div style="margin-top: 30px;">
            <a href="{{ url_for('perfil.pagina_meu_perfil') }}" class="nav-item"
               style="width: auto; padding: 10px 20px; background: transparent; color: var(--primary);">
                <i class="fas fa-chevron-left"></i> Voltar para meu Perfil
            </a>
        </div>
    </section>
{% endblock %}